# 1. Install necessary packages (if you haven't already)
if (!require("readxl")) install.packages("readxl")
if (!require("tidyverse")) install.packages("tidyverse")
if (!require("zoo")) install.packages("zoo") # 'zoo' is needed for filling missing values
library(readxl)
library(readxl)
library(dplyr)
library(tidyr)
library(zoo)
raw_data <- read_excel("2E4EVCP0.xlsx", col_names = FALSE)
View(raw_data)
years_raw <- as.numeric(as.vector(raw_data[1, -1]))
years_clean <- na.locf(years_raw, na.rm = FALSE)
periods_raw <- as.character(as.vector(raw_data[2, -1]))
yield_raw <- as.numeric(as.vector(raw_data[5, -1]))
temp_df <- data.frame(
Year = years_clean,
Period = periods_raw,
Yield = yield_raw,
stringsAsFactors = FALSE
)
View(temp_df)
final_df <- temp_df %>%
# Filter: We only want rows where Period contains "Quarter"
filter(grepl("Quarter", Period)) %>%
# Extract the Quarter Number (e.g., "Quarter 1" -> 1)
mutate(
Quarter = as.numeric(gsub("Quarter ", "", Period)),
# Create a specific Date column for plotting (Day is set to 1st of the Quarter)
# Q1=Jan(1), Q2=Apr(4), Q3=Jul(7), Q4=Oct(10)
Date = as.Date(paste(Year, (Quarter - 1) * 3 + 1, "01", sep = "-"))
) %>%
# Select and reorder the columns we need
select(Date, Year, Quarter, Yield) %>%
# Sort by Date just to be safe
arrange(Date)
View(final_df)
print(head(final_df))
print(paste("Missing Values:", sum(is.na(final_df$Yield))))
write.csv(final_df, "Pangasinan_Rice_Yield_Clean.csv", row.names = FALSE)
# Simple plot to verify the data looks correct
plot(final_df$Date, final_df$Yield, type = "l", col = "green",
main = "Quarterly Rice Yield in Pangasinan",
xlab = "Year", ylab = "Yield (MT)")
